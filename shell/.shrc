#! sh
####################################
# SHARED SHELL CONFIGURATION
####################################
# Sourced by both .bashrc and .zshrc
# Contains common settings for all POSIX-compatible shells

####################################
# TERMINAL SETTINGS
####################################

case "$TERM" in
    xterm*|*rxvt*) TERM=xterm-256color
esac

####################################
# ENVIRONMENT VARIABLES
####################################

# Load secrets (API keys, tokens, etc)
[ -f "${HOME}/.secrets" ] && source ~/.secrets

# Project navigation
CDPATH=.:~/projects

# Tool configuration
ANSIBLE_VAULT_PASSWORD_FILE=~/.vault_pass.txt
RIPGREP_CONFIG_PATH=~/.ripgrep
KEYTIMEOUT=1

# Devpack and GPG
export DEVPACK_SILENT=1
export GPG_TTY=$(tty)

####################################
# NODE VERSION MANAGER (NVM)
####################################

export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" --no-use # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && . "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

####################################
# LS COLORS (Linux only)
####################################

if [ "$(uname -s)" = "Linux" ]; then
eval $(dircolors "$HOME/.dir_colors")
fi

####################################
# FZF CONFIGURATION
####################################

# Set FZF default commands based on available tools (fd > rg > ag)

if type fd > /dev/null; then
    FZF_DEFAULT_COMMAND='fd --type f --hidden --exclude .git --exclude pythonx'
    FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    FZF_ALT_C_COMMAND='fd --type d'
elif type rg > /dev/null; then
    FZF_DEFAULT_COMMAND='rg --files'
    FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
elif type ag > /dev/null; then
    FZF_DEFAULT_COMMAND='ag -l --hidden --ignore .git'
    FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
fi
export FZF_DEFAULT_COMMAND FZF_CTRL_T_COMMAND FZF_ALT_C_COMMAND

